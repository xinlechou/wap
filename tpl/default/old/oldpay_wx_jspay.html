{include file="old/old_header.html"}
<link rel="stylesheet" type="text/css" href="{$TMPL}/old/css/pay.css"/>
<div id="nav">
    <div class="top">
        <div class="top_left">
            <!--<a href="{url_wap r="old#home"}"><img src="{$TMPL}/old/images/exit.png"></a>-->
        </div>
        <div class="top_center">{$page_title}</div>
        <div class="top_right"></div>
    </div>
</div>
<style>body{background: #fff}</style>
<div class="box">
    {if $data.pay_status eq 0}
    <div class="pay_sucsss" id="pay_info">
        <p>付款金额</p>
        <p style="border-bottom:1px solid #dddddd;padding-bottom:5%;">¥{$data.money}</p>
        {if $data.notice_sn}<div class="pay_info">订单编号<span>{$data.notice_sn}</span></div>{/if}
        <div class="pay_info">自动进入支付<span>¥{$data.money}</span></div>
        <ul id="buttom_div">
            <li><a href="javascript:void(0)" onclick="javascript:window.location.replace('{url_wap r="old"}')">返回首页</a></li>
        </ul>
    </div>
    {/if}
    <!--支付错误时显示-->
    <div class="pay_sucsss pay_result" id="pay_error">
        <img src="{$TMPL}/old/images/fail.jpg">
        <p>支付遇到问题</p>
        <ul>
            <li><a href="javascript:void(0)" onclick="javascript:window.location.replace('{url_wap r="old#home_exchange"}')">继续支付</a></li>
            <li><a href="javascript:void(0)" onclick="javascript:window.location.replace('{url_wap r="old"}')">返回首页</a></li>
        </ul>
    </div>

    <!--支付成功时显示-->
    <div class="pay_sucsss {if $data.pay_status neq 1}pay_result{/if}" id="pay_success">
        <img src="{$TMPL}/old/images/sucess.jpg">
        <p>支付完成</p>
        <ul>
            <li><a href="javascript:void(0)" onclick="javascript:window.location.replace('{url_wap r="old#home_exchange"}')">查看申请</a></li>
            <li><a href="javascript:void(0)" onclick="javascript:window.location.replace('{url_wap r="old"}')">返回首页</a></li>
        </ul>
    </div>

</div>
{include file="old/old_inc_footer.html"}
</body>
<script type="text/javascript">
    var deal_id = {$data.deal_id};
    if( document.addEventListener ){
        document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
    }else if (document.attachEvent){
        document.attachEvent('WeixinJSBridgeReady', jsApiCall);
        document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
    }
    //调用微信JS api 支付
    function jsApiCall()
    {
        WeixinJSBridge.invoke(
                'getBrandWCPayRequest',
                {$jsApiParameters},
                function(res){
                    if(res.err_msg=='get_brand_wcpay_request:fail'){
                        $("#pay_error").show();
                    }
                    if(res.err_msg=='get_brand_wcpay_request:cancel '){
                        $("#pay_error").show();
                    }
                    if(res.err_msg=='get_brand_wcpay_request:ok'){
                        $("#pay_success").css("display","block");
                    }else{
                        $("#pay_error").css("display","block");
                    }
                    $("#pay_info").hide();
                }
        );
    }

    function callpay()
    {
        if (typeof WeixinJSBridge == "undefined"){
            if( document.addEventListener ){
                document.addEventListener('WeixinJSBridgeReady', jsApiCall, false);
            }else if (document.attachEvent){
                document.attachEvent('WeixinJSBridgeReady', jsApiCall);
                document.attachEvent('onWeixinJSBridgeReady', jsApiCall);
            }
        }else{
            jsApiCall();
        }
    }
    function  callpay_1() {
        wx.chooseWXPay({$jsApiParameters});
    }

</script>
<script src="http://res.wx.qq.com/open/js/jweixin-1.0.0.js"></script>
<script>
    wx.config({
                debug: false,
                appId: '{$signPackage.appId}',
                timestamp: {$signPackage.timestamp},
            nonceStr: '{$signPackage.nonceStr}',
            signature: '{$signPackage.signature}',
            jsApiList: [
        'checkJsApi',
        'onMenuShareTimeline',
        'onMenuShareAppMessage',
        'onMenuShareQQ',
        'onMenuShareWeibo',
        'hideMenuItems',
        'showMenuItems',
        'shareTimeline',
        'hideAllNonBaseMenuItem',
        'showAllNonBaseMenuItem',
        'translateVoice',
        'startRecord',
        'stopRecord',
        'onRecordEnd',
        'playVoice',
        'pauseVoice',
        'stopVoice',
        'uploadVoice',
        'downloadVoice',
        'chooseImage',
        'previewImage',
        'uploadImage',
        'downloadImage',
        'getNetworkType',
        'openLocation',
        'getLocation',
        'hideOptionMenu',
        'showOptionMenu',
        'closeWindow',
        'scanQRCode',
        'chooseWXPay',
        'openProductSpecificView',
        'addCard',
        'chooseCard',
        'openCard'
    ]
    });
    wx.checkJsApi({
        jsApiList: [
            'getLocation',
            'shareTimeline',
            'onMenuShareAppMessage'
        ],
        success: function (res) {
            alert(JSON.stringify(res));
        }
    });
    wx.ready(function () {
        // 在这里调用 API
        wx.onMenuShareTimeline({
            // title: '{$page_title}', // 分享标题
            link: '{$wx_url}', // 分享链接
            imgUrl: '{$wx_image}', // 分享图标
            success: function () {
                // 用户确认分享后执行的回调函数
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        });
        wx.onMenuShareAppMessage({
            //title: '', // 分享标题
            desc: '{$wx_desc}', // 分享描述
            link:'{$wx_url}',  // 分享链接
            imgUrl: '{$wx_image}', // 分享图标
            type: 'link', // 分享类型,music、video或link，不填默认为link
            // dataUrl: '', // 如果type是music或video，则要提供数据链接，默认为空
            success: function () {
                // 用户确认分享后执行的回调函数
            },
            cancel: function () {
                // 用户取消分享后执行的回调函数
            }
        });
    });
</script>
</html>